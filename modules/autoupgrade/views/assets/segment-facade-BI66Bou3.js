/**
 * Copyright since 2007 PrestaShop SA and Contributors
 * PrestaShop is an International Registered Trademark & Property of PrestaShop SA
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License version 3.0
 * that is bundled with this package in the file LICENSE.md.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/AFL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * @author    PrestaShop SA and Contributors <contact@prestashop.com>
 * @copyright Since 2007 PrestaShop SA and Contributors
 * @license   https://opensource.org/licenses/AFL-3.0 Academic Free License version 3.0
 */
import{r as t}from"./segment-isodate-DZqlg9qm.js";import{r as e}from"./segment-isodate-traverse-DdrIA5-2.js";var r,i,n={},o={},a={},s={exports:{}};function u(){return r||(r=1,function(t){function e(t){return function(e,r,i,o){var a,s=o&&function(t){return"function"==typeof t}(o.normalizer)?o.normalizer:n;r=s(r);for(var u=!1;!u;)p();function p(){for(a in e){var t=s(a);if(0===r.indexOf(t)){var i=r.substr(t.length);if("."===i.charAt(0)||0===i.length){r=i.substr(1);var n=e[a];return null==n?void(u=!0):r.length?void(e=n):void(u=!0)}}}a=void 0,u=!0}if(a)return null==e?e:t(e,a,i)}}function r(t,e){return t.hasOwnProperty(e)&&delete t[e],t}function i(t,e,r){return t.hasOwnProperty(e)&&(t[e]=r),t}function n(t){return t.replace(/[^a-zA-Z0-9\.]+/g,"").toLowerCase()}t.exports=e((function(t,e){if(t.hasOwnProperty(e))return t[e]})),t.exports.find=t.exports,t.exports.replace=function(t,r,n,o){return e(i).call(this,t,r,n,o),t},t.exports.del=function(t,i,n){return e(r).call(this,t,i,null,n),t}}(s)),s.exports}var p,c={};var f,d={};var l,y={};var h,v,x,m,b={};function _(){if(x)return v;x=1;var e=t(),r=function(){if(l)return y;l=1;var t=/\d{13}/;return y.is=function(e){return t.test(e)},y.parse=function(t){return t=parseInt(t,10),new Date(t)},y}(),i=function(){if(h)return b;h=1;var t=/\d{10}/;return b.is=function(e){return t.test(e)},b.parse=function(t){var e=1e3*parseInt(t,10);return new Date(e)},b}(),n=Object.prototype.toString;return v=function(t){return o=t,"[object Date]"===n.call(o)?t:function(t){return"[object Number]"===n.call(t)}(t)?new Date((a=t)<315576e5?1e3*a:a):e.is(t)?e.parse(t):r.is(t)?r.parse(t):i.is(t)?i.parse(t):new Date(t);var o,a}}function g(){if(m)return o;m=1;var t=o&&o.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0}),o.Facade=void 0;var r=t(function(){if(i)return a;i=1;var t=a&&a.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(a,"__esModule",{value:!0});var e=t(u());function r(t,r){return function(){var i=this.traits(),n=this.properties?this.properties():{};return e.default(i,"address."+t)||e.default(i,t)||(r?e.default(i,"address."+r):null)||(r?e.default(i,r):null)||e.default(n,"address."+t)||e.default(n,t)||(r?e.default(n,"address."+r):null)||(r?e.default(n,r):null)}}return a.default=function(t){t.zip=r("postalCode","zip"),t.country=r("country"),t.street=r("street"),t.state=r("state"),t.city=r("city"),t.region=r("region")},a}()),n=(p||(p=1,Object.defineProperty(c,"__esModule",{value:!0}),c.clone=void 0,c.clone=function t(e){if("object"!=typeof e)return e;if("[object Object]"===Object.prototype.toString.call(e)){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t(e[i]));return r}return Array.isArray(e)?e.map(t):e}),c),s=t(function(){if(f)return d;f=1,Object.defineProperty(d,"__esModule",{value:!0});var t={Salesforce:!0};return d.default=function(e){return!t[e]},d}()),l=t(_()),y=t(u()),h=t(e());function v(t,e){e=e||{},this.raw=n.clone(t),"clone"in e||(e.clone=!0),e.clone&&(t=n.clone(t)),"traverse"in e||(e.traverse=!0),t.timestamp="timestamp"in t?l.default(t.timestamp):new Date,e.traverse&&h.default(t),this.opts=e,this.obj=t}o.Facade=v;var x=v.prototype;function b(t){return n.clone(t)}return x.proxy=function(t){var e=t.split("."),r=this[t=e.shift()]||this.obj[t];return r?("function"==typeof r&&(r=r.call(this)||{}),0===e.length||(r=y.default(r,e.join("."))),this.opts.clone?b(r):r):r},x.field=function(t){var e=this.obj[t];return this.opts.clone?b(e):e},v.proxy=function(t){return function(){return this.proxy(t)}},v.field=function(t){return function(){return this.field(t)}},v.multi=function(t){return function(){var e=this.proxy(t+"s");if(Array.isArray(e))return e;var r=this.proxy(t);return r&&(r=[this.opts.clone?n.clone(r):r]),r||[]}},v.one=function(t){return function(){var e=this.proxy(t);if(e)return e;var r=this.proxy(t+"s");return Array.isArray(r)?r[0]:void 0}},x.json=function(){var t=this.opts.clone?n.clone(this.obj):this.obj;return this.type&&(t.type=this.type()),t},x.rawEvent=function(){return this.raw},x.options=function(t){var e=this.obj.options||this.obj.context||{},r=this.opts.clone?n.clone(e):e;if(!t)return r;if(this.enabled(t)){var i=this.integrations(),o=i[t]||y.default(i,t);return"object"!=typeof o&&(o=y.default(this.options(),t)),"object"==typeof o?o:{}}},x.context=x.options,x.enabled=function(t){var e=this.proxy("options.providers.all");"boolean"!=typeof e&&(e=this.proxy("options.all")),"boolean"!=typeof e&&(e=this.proxy("integrations.all")),"boolean"!=typeof e&&(e=!0);var r=e&&s.default(t),i=this.integrations();if(i.providers&&i.providers.hasOwnProperty(t)&&(r=i.providers[t]),i.hasOwnProperty(t)){var n=i[t];r="boolean"!=typeof n||n}return!!r},x.integrations=function(){return this.obj.integrations||this.proxy("options.providers")||this.options()},x.active=function(){var t=this.proxy("options.active");return null==t&&(t=!0),t},x.anonymousId=function(){return this.field("anonymousId")||this.field("sessionId")},x.sessionId=x.anonymousId,x.groupId=v.proxy("options.groupId"),x.traits=function(t){var e=this.proxy("options.traits")||{},r=this.userId();for(var i in t=t||{},r&&(e.id=r),t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=null==this[i]?this.proxy("options.traits."+i):this[i]();if(null==n)continue;e[t[i]]=n,delete e[i]}return e},x.library=function(){var t=this.proxy("options.library");return t?"string"==typeof t?{name:t,version:null}:t:{name:"unknown",version:null}},x.device=function(){var t=this.proxy("context.device");"object"==typeof t&&null!==t||(t={});var e=this.library().name;return t.type||(e.indexOf("ios")>-1&&(t.type="ios"),e.indexOf("android")>-1&&(t.type="android")),t},x.userAgent=v.proxy("context.userAgent"),x.timezone=v.proxy("context.timezone"),x.timestamp=v.field("timestamp"),x.channel=v.field("channel"),x.ip=v.proxy("context.ip"),x.userId=v.field("userId"),r.default(x),o}var j,I,F={},O={exports:{}};function P(){return j||(j=1,"function"==typeof Object.create?O.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:O.exports=function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}),O.exports}var w,M,D={},A={};function k(){if(w)return A;w=1,Object.defineProperty(A,"__esModule",{value:!0});var t=/.+\@.+\..+/;return A.default=function(e){return t.test(e)},A}var S,N={};function T(){if(S)return N;S=1;var t=N&&N.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(N,"__esModule",{value:!0}),N.Identify=void 0;var e=g(),r=t(u()),i=t(P()),n=t(k()),o=t(_()),a=function(t){return t.trim()};function s(t,r){e.Facade.call(this,t,r)}N.Identify=s,i.default(s,e.Facade);var p=s.prototype;return p.action=function(){return"identify"},p.type=p.action,p.traits=function(t){var e=this.field("traits")||{},r=this.userId();for(var i in t=t||{},r&&(e.id=r),t){var n=null==this[i]?this.proxy("traits."+i):this[i]();null!=n&&(e[t[i]]=n,i!==t[i]&&delete e[i])}return e},p.email=function(){var t=this.proxy("traits.email");if(t)return t;var e=this.userId();return n.default(e)?e:void 0},p.created=function(){var t=this.proxy("traits.created")||this.proxy("traits.createdAt");if(t)return o.default(t)},p.companyCreated=function(){var t=this.proxy("traits.company.created")||this.proxy("traits.company.createdAt");if(t)return o.default(t)},p.companyName=function(){return this.proxy("traits.company.name")},p.name=function(){var t=this.proxy("traits.name");if("string"==typeof t)return a(t);var e=this.firstName(),r=this.lastName();return e&&r?a(e+" "+r):void 0},p.firstName=function(){var t=this.proxy("traits.firstName");if("string"==typeof t)return a(t);var e=this.proxy("traits.name");return"string"==typeof e?a(e).split(" ")[0]:void 0},p.lastName=function(){var t=this.proxy("traits.lastName");if("string"==typeof t)return a(t);var e=this.proxy("traits.name");if("string"==typeof e){var r=a(e).indexOf(" ");if(-1!==r)return a(e.substr(r+1))}},p.uid=function(){return this.userId()||this.username()||this.email()},p.description=function(){return this.proxy("traits.description")||this.proxy("traits.background")},p.age=function(){var t=this.birthday(),e=r.default(this.traits(),"age");return null!=e?e:t instanceof Date?(new Date).getFullYear()-t.getFullYear():void 0},p.avatar=function(){var t=this.traits();return r.default(t,"avatar")||r.default(t,"photoUrl")||r.default(t,"avatarUrl")},p.position=function(){var t=this.traits();return r.default(t,"position")||r.default(t,"jobTitle")},p.username=e.Facade.proxy("traits.username"),p.website=e.Facade.one("traits.website"),p.websites=e.Facade.multi("traits.website"),p.phone=e.Facade.one("traits.phone"),p.phones=e.Facade.multi("traits.phone"),p.address=e.Facade.proxy("traits.address"),p.gender=e.Facade.proxy("traits.gender"),p.birthday=e.Facade.proxy("traits.birthday"),N}var z,G={};function q(){if(z)return G;z=1;var t=G&&G.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(G,"__esModule",{value:!0}),G.Track=void 0;var e=t(P()),r=g(),i=T(),n=t(k()),o=t(u());function a(t,e){r.Facade.call(this,t,e)}G.Track=a,e.default(a,r.Facade);var s=a.prototype;return s.action=function(){return"track"},s.type=s.action,s.event=r.Facade.field("event"),s.value=r.Facade.proxy("properties.value"),s.category=r.Facade.proxy("properties.category"),s.id=r.Facade.proxy("properties.id"),s.productId=function(){return this.proxy("properties.product_id")||this.proxy("properties.productId")},s.promotionId=function(){return this.proxy("properties.promotion_id")||this.proxy("properties.promotionId")},s.cartId=function(){return this.proxy("properties.cart_id")||this.proxy("properties.cartId")},s.checkoutId=function(){return this.proxy("properties.checkout_id")||this.proxy("properties.checkoutId")},s.paymentId=function(){return this.proxy("properties.payment_id")||this.proxy("properties.paymentId")},s.couponId=function(){return this.proxy("properties.coupon_id")||this.proxy("properties.couponId")},s.wishlistId=function(){return this.proxy("properties.wishlist_id")||this.proxy("properties.wishlistId")},s.reviewId=function(){return this.proxy("properties.review_id")||this.proxy("properties.reviewId")},s.orderId=function(){return this.proxy("properties.id")||this.proxy("properties.order_id")||this.proxy("properties.orderId")},s.sku=r.Facade.proxy("properties.sku"),s.tax=r.Facade.proxy("properties.tax"),s.name=r.Facade.proxy("properties.name"),s.price=r.Facade.proxy("properties.price"),s.total=r.Facade.proxy("properties.total"),s.repeat=r.Facade.proxy("properties.repeat"),s.coupon=r.Facade.proxy("properties.coupon"),s.shipping=r.Facade.proxy("properties.shipping"),s.discount=r.Facade.proxy("properties.discount"),s.shippingMethod=function(){return this.proxy("properties.shipping_method")||this.proxy("properties.shippingMethod")},s.paymentMethod=function(){return this.proxy("properties.payment_method")||this.proxy("properties.paymentMethod")},s.description=r.Facade.proxy("properties.description"),s.plan=r.Facade.proxy("properties.plan"),s.subtotal=function(){var t=o.default(this.properties(),"subtotal"),e=this.total()||this.revenue();if(t)return t;if(!e)return 0;if(this.total()){var r=this.tax();r&&(e-=r),(r=this.shipping())&&(e-=r),(r=this.discount())&&(e+=r)}return e},s.products=function(){var t=this.properties(),e=o.default(t,"products");return Array.isArray(e)?e.filter((function(t){return null!==t})):[]},s.quantity=function(){return(this.obj.properties||{}).quantity||1},s.currency=function(){return(this.obj.properties||{}).currency||"USD"},s.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},s.query=r.Facade.proxy("options.query"),s.properties=function(t){var e=this.field("properties")||{};for(var r in t=t||{})if(Object.prototype.hasOwnProperty.call(t,r)){var i=null==this[r]?this.proxy("properties."+r):this[r]();if(null==i)continue;e[t[r]]=i,delete e[r]}return e},s.username=function(){return this.proxy("traits.username")||this.proxy("properties.username")||this.userId()||this.sessionId()},s.email=function(){var t=this.proxy("traits.email")||this.proxy("properties.email")||this.proxy("options.traits.email");if(t)return t;var e=this.userId();return n.default(e)?e:void 0},s.revenue=function(){var t=this.proxy("properties.revenue"),e=this.event();return!t&&e&&e.match(/^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i)&&(t=this.proxy("properties.total")),function(t){if(!t)return;if("number"==typeof t)return t;if("string"!=typeof t)return;if(t=t.replace(/\$/g,""),t=parseFloat(t),!isNaN(t))return t}(t)},s.cents=function(){var t=this.revenue();return"number"!=typeof t?this.value()||0:100*t},s.identify=function(){var t=this.json();return t.traits=this.traits(),new i.Identify(t,this.opts)},G}var C,L={};function U(){if(C)return L;C=1;var t=L&&L.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(L,"__esModule",{value:!0}),L.Page=void 0;var e=t(P()),r=g(),i=q(),n=t(k());function o(t,e){r.Facade.call(this,t,e)}L.Page=o,e.default(o,r.Facade);var a=o.prototype;return a.action=function(){return"page"},a.type=a.action,a.category=r.Facade.field("category"),a.name=r.Facade.field("name"),a.title=r.Facade.proxy("properties.title"),a.path=r.Facade.proxy("properties.path"),a.url=r.Facade.proxy("properties.url"),a.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},a.properties=function(t){var e=this.field("properties")||{},r=this.category(),i=this.name();for(var n in t=t||{},r&&(e.category=r),i&&(e.name=i),t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=null==this[n]?this.proxy("properties."+n):this[n]();if(null==o)continue;e[t[n]]=o,n!==t[n]&&delete e[n]}return e},a.email=function(){var t=this.proxy("context.traits.email")||this.proxy("properties.email");if(t)return t;var e=this.userId();return n.default(e)?e:void 0},a.fullName=function(){var t=this.category(),e=this.name();return e&&t?t+" "+e:e},a.event=function(t){return t?"Viewed "+t+" Page":"Loaded a Page"},a.track=function(t){var e=this.json();return e.event=this.event(t),e.timestamp=this.timestamp(),e.properties=this.properties(),new i.Track(e,this.opts)},L}var V,Y={};var E,Z,B={};var H=(Z||(Z=1,function(t){var e=n&&n.__assign||function(){return e=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},e.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Delete=t.Screen=t.Page=t.Track=t.Identify=t.Group=t.Alias=t.Facade=void 0;var r=g();Object.defineProperty(t,"Facade",{enumerable:!0,get:function(){return r.Facade}});var i=function(){if(I)return F;I=1;var t=F&&F.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(F,"__esModule",{value:!0}),F.Alias=void 0;var e=t(P()),r=g();function i(t,e){r.Facade.call(this,t,e)}return F.Alias=i,e.default(i,r.Facade),i.prototype.action=function(){return"alias"},i.prototype.type=i.prototype.action,i.prototype.previousId=function(){return this.field("previousId")||this.field("from")},i.prototype.from=i.prototype.previousId,i.prototype.userId=function(){return this.field("userId")||this.field("to")},i.prototype.to=i.prototype.userId,F}();Object.defineProperty(t,"Alias",{enumerable:!0,get:function(){return i.Alias}});var o=function(){if(M)return D;M=1;var t=D&&D.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(D,"__esModule",{value:!0}),D.Group=void 0;var e=t(P()),r=t(k()),i=t(_()),n=g();function o(t,e){n.Facade.call(this,t,e)}D.Group=o,e.default(o,n.Facade);var a=o.prototype;return a.action=function(){return"group"},a.type=a.action,a.groupId=n.Facade.field("groupId"),a.created=function(){var t=this.proxy("traits.createdAt")||this.proxy("traits.created")||this.proxy("properties.createdAt")||this.proxy("properties.created");if(t)return i.default(t)},a.email=function(){var t=this.proxy("traits.email");if(t)return t;var e=this.groupId();return r.default(e)?e:void 0},a.traits=function(t){var e=this.properties(),r=this.groupId();for(var i in t=t||{},r&&(e.id=r),t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=null==this[i]?this.proxy("traits."+i):this[i]();if(null==n)continue;e[t[i]]=n,delete e[i]}return e},a.name=n.Facade.proxy("traits.name"),a.industry=n.Facade.proxy("traits.industry"),a.employees=n.Facade.proxy("traits.employees"),a.properties=function(){return this.field("traits")||this.field("properties")||{}},D}();Object.defineProperty(t,"Group",{enumerable:!0,get:function(){return o.Group}});var a=T();Object.defineProperty(t,"Identify",{enumerable:!0,get:function(){return a.Identify}});var s=q();Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return s.Track}});var u=U();Object.defineProperty(t,"Page",{enumerable:!0,get:function(){return u.Page}});var p=function(){if(V)return Y;V=1;var t=Y&&Y.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Y,"__esModule",{value:!0}),Y.Screen=void 0;var e=t(P()),r=U(),i=q();function n(t,e){r.Page.call(this,t,e)}return Y.Screen=n,e.default(n,r.Page),n.prototype.action=function(){return"screen"},n.prototype.type=n.prototype.action,n.prototype.event=function(t){return t?"Viewed "+t+" Screen":"Loaded a Screen"},n.prototype.track=function(t){var e=this.json();return e.event=this.event(t),e.timestamp=this.timestamp(),e.properties=this.properties(),new i.Track(e,this.opts)},Y}();Object.defineProperty(t,"Screen",{enumerable:!0,get:function(){return p.Screen}});var c=function(){if(E)return B;E=1;var t=B&&B.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(B,"__esModule",{value:!0}),B.Delete=void 0;var e=t(P()),r=g();function i(t,e){r.Facade.call(this,t,e)}return B.Delete=i,e.default(i,r.Facade),i.prototype.type=function(){return"delete"},B}();Object.defineProperty(t,"Delete",{enumerable:!0,get:function(){return c.Delete}}),t.default=e(e({},r.Facade),{Alias:i.Alias,Group:o.Group,Identify:a.Identify,Track:s.Track,Page:u.Page,Screen:p.Screen,Delete:c.Delete})}(n)),n);export{H as d};
