/**
* Prestashop Addons | Module by: <App1Pro>
*
* @author    Chuyen Nguyen [App1Pro].
* @copyright Chuyenim@gmail.com
* @license   http://app1pro.com/license.txt
*/

!function(t){t.fn.relatedProductPro=function(){var e=t(this),n=e.attr("ajax-link")||null,i=e.attr("ajax-remote_url")||null,a=e.attr("id-product")||0,o="undefined"!=typeof update_success_msg?update_success_msg:"Updated successfully!";e.find(".related_product tbody").sortable({stop:function(i,d){var r=new Array;e.find('input[name="related_product_input[]"]').each(function(e){r.push(t(this).val())}),r.length&&t.post(n,{id_product:a,related_ids:r,action:"UpdatePositions"},function(t){"Ok"===t&&showSuccessMessage(o)})}}),e.find(".related_product tbody").disableSelection();var d=e.find("#row_template");e.find("#row_template").remove();function r(){var i=e.find('[name="is_custom"]:checked').val()||0,d=e.find('[name="id_type"]:checked').val()||0;t.post(n,{id_product:a,is_custom:i,id_type:d,action:"UpdateSettings"},function(t){"Ok"===t&&showSuccessMessage(o)})}e.find("#product_autocomplete_input").keyup(function(){var r=t.trim(t(this).val()),s=new Array;s.push(a),e.find('input[name="related_product_input[]"]').each(function(e){s.push(t(this).val())}),r.length?t.post(i,{q:r,limit:20,excludeIds:s.join()},function(i){e.find(".ajax_result").html("").hide();for(var r=0;r<i.length;r++){var s=t("<a>").attr("rel",i[r].id).attr("title",i[r].name).attr("href","javascript:void(0);");s.html('<img src="'+i[r].image+'" width="36px" height="36px"> <span>'+i[r].id+". "+i[r].name+"</span></a>"),s.appendTo(t(".ajax_result").show()),s.click(function(e){var i,r,s;e.preventDefault(),i=t(this).attr("rel"),r=t(this).attr("title"),(s=d.clone().removeAttr("id")).find("td").eq(1).text(i),s.find("td").eq(2).text(r),s.find('input[name="related_product_input[]"]').val(i),s.appendTo(".related_product tbody"),t.post(n,{id_product:a,id_related:i,action:"AddProduct"},function(t){"Ok"===t&&showSuccessMessage(o)})})}},"json"):e.find(".ajax_result").html("").hide()}),e.find("#product_autocomplete_input").blur(function(){t(this).parents().find("#product_autocomplete_input").val(""),setTimeout(function(){e.find(".ajax_result").hide()},200)}),e.on("click",".delete_product_related",function(e){if(e.preventDefault(),e.stopPropagation(),confirm(confirm_delete_related)){var i=t(this).closest("tr").find('input[name="related_product_input[]"]').val();t(this).closest("tr").remove(),t.post(n,{id_product:a,id_related:i,action:"DeleteProduct"},function(t){"Ok"===t&&showSuccessMessage(o)})}}),e.on("change",'[name="is_custom"]',function(e){return console.log("log"),t(this).prop("checked")?t("#collapseOverrideSettings").removeClass("hide").addClass("show"):t("#collapseOverrideSettings").removeClass("show").addClass("hide"),r(),!0}),e.on("change",'[name="id_type"]',function(t){return r(),!0})},t(document).ready(function(){t("#product_related").relatedProductPro()})}(jQuery);
