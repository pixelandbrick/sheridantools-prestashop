/**
* Prestashop Addons | Module by: <App1Pro>
*
* @author    Chuyen Nguyen [App1Pro].
* @copyright Chuyenim@gmail.com
* @license   http://app1pro.com/license.txt
*/

!function(t){t.fn.relatedProductPro=function(){var e=t(this),n=e.attr("ajax-link")||null,i=e.attr("ajax-remote_url")||null,a=e.attr("id-product")||0,o="undefined"!=typeof update_success_msg?update_success_msg:"Updated successfully!";e.find(".related_product tbody").sortable({stop:function(i,d){var s=new Array;e.find('input[name="related_product_input[]"]').each(function(e){s.push(t(this).val())}),s.length&&t.post(n,{id_product:a,related_ids:s,action:"UpdatePositions"},function(t){"Ok"===t&&showSuccessMessage(o)})}}),e.find(".related_product tbody").disableSelection();var d=e.find("#row_template");e.find("#row_template").remove();function s(){var i=e.find('[name="is_custom"]:checked').val()||0,d=e.find('[name="id_type"]:checked').val()||0;t.post(n,{id_product:a,is_custom:i,id_type:d,action:"UpdateSettings"},function(t){"Ok"===t&&showSuccessMessage(o)})}e.find("input[name=product_autocomplete_input]").keyup(function(){var s=t.trim(t(this).val()),r=new Array;r.push(a),e.find('input[name="related_product_input[]"]').each(function(e){r.push(t(this).val())}),s.length?t.post(i,{q:s,limit:20,excludeIds:r.join()},function(i){e.find(".ajax_result").html("").hide();for(var s=i.split("\n"),r=0;r<s.length-1;r++){var c=s[r].lastIndexOf("|"),u=s[r].substr(0,c).trim(),l=s[r].slice(c+1,s[r].length).trim(),p=t("<a>").attr("rel",l).attr("title",u).attr("href","javascript:void(0);");p.html("<span>"+l+". "+u+"</span></a>"),p.appendTo(e.find(".ajax_result").show()),p.click(function(e){var i,s,r;e.preventDefault(),i=t(this).attr("rel"),s=t(this).attr("title"),(r=d.clone().removeAttr("id")).find("td").eq(1).text(i),r.find("td").eq(2).text(s),r.find('input[name="related_product_input[]"]').val(i),r.appendTo(".related_product tbody"),t.post(n,{id_product:a,id_related:i,action:"AddProduct"},function(t){"Ok"===t&&showSuccessMessage(o)})})}}):e.find(".ajax_result").html("").hide()}),e.find("input[name=product_autocomplete_input]").blur(function(){t(this).val(""),setTimeout(function(){e.find(".ajax_result").hide()},200)}),e.on("click",".delete_product_related",function(e){if(e.preventDefault(),e.stopPropagation(),confirm(confirm_delete_related)){var i=t(this).closest("tr").find('input[name="related_product_input[]"]').val();t(this).closest("tr").remove(),t.post(n,{id_product:a,id_related:i,action:"DeleteProduct"},function(t){"Ok"===t&&showSuccessMessage(o)})}}),e.on("change",'[name="is_custom"]',function(e){return console.log("log"),t(this).prop("checked")?t("#collapseOverrideSettings").removeClass("hide").addClass("show"):t("#collapseOverrideSettings").removeClass("show").addClass("hide"),s(),!0}),e.on("change",'[name="id_type"]',function(t){return s(),!0})}}(jQuery);
